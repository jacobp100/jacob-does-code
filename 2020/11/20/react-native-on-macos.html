<!DOCTYPE HTML><html lang="en"><head><title>React Native on macOS</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><script>document.documentElement.style.setProperty("--b",1/(window.devicePixelRatio||1)+"px");</script><style>@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:normal;font-named-instance:"Regular";src:url(/71cddff5.woff2);font-display:fallback}@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:italic;font-named-instance:"Regular";src:url(/fonts/Inter-italic.var.woff2);font-display:fallback}*,::after,::before{box-sizing:border-box}*{font-weight:var(--c)}@supports (font-variation-settings:"wght" 400){*{font-weight:inherit;font-variation-settings:"wght" var(--c)}}:root{--d:#f97f51;--e:#fc427b;--f:#0652dd;--g:#2771f9;--h:var(--f);--i:#a3cb38;--j:#ed4c67;--a:currentColor;--k:black;--l:white;--m:12px;--n:12px}body{margin:var(--m) var(--n) 64px;font:18px/26px Inter,system-ui,-apple-system,sans-serif;color:var(--k);background:var(--l)}a{color:var(--a, currentColor);text-decoration:none}a:active,a:focus,a:hover{text-decoration:underline}.a{display:flex;padding-top:12px;margin:-12px calc(-1*var(--n)) 48px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch}.a::after,.a::before{display:block;content:"";padding-right:var(--n)}.b,.c{flex:none;--c:700}.b{display:block;font-size:24px;line-height:18px;letter-spacing:-1px;text-transform:lowercase;border-top:4px solid currentColor;padding:6px 4px 0 0}a.b{color:currentColor;text-decoration:none}.c{margin:0 0 0 24px;font-size:6px;line-height:10px;letter-spacing:1px;text-transform:uppercase;width:0}.d{margin-left:auto}.e{flex:none;display:block;margin:10px 24px 0 0;font-size:14px;--c:400;line-height:18px}.e:last-child{margin-right:0}@media (prefers-color-scheme:dark){:root{--h:var(--g);--k:white;--l:black}}@media (min-width:768px){:root{--n:64px}}@media (min-width:1024px){:root{--n:128px}}:root{--n:max(12px, (100vw - var(--o)) / 2);--o:800px;--a:var(--j)}h1,h2{font-weight:700}h1{margin:48px 0 32px;font-size:36px;line-height:52px;letter-spacing:-.8px}h2{font-size:26px;line-height:34px;letter-spacing:-.3px}blockquote,h3{font-size:22px;line-height:32px}h2,h3{margin:42px 0 18px}h3{letter-spacing:-.18px}p{margin:18px 0}h3,strong{font-weight:600}ol,ul{margin:24px 0;padding-left:32px;margin-left:calc(-32*min(max(var(--n) - 32px,0px),1px))}li{position:relative;margin:2px 0;list-style:none}li::before{position:absolute;content:var(--p, "ðŸ‘‰");right:calc(100% + 12px)}li[data-bullet]{--p:attr(data-bullet)}blockquote{margin:32px 24px 32px 48px;font-weight:300;font-style:italic;color:#9e9e9e}table{margin:24px;border-collapse:separate;border-spacing:12px 0}thead th{border-bottom:var(--b) solid;--c:600;text-align:left}code{font-size:.9em;font-family:monospace;padding:0 3px;background-color:#f4f4f4;border:1px solid #eee;border-radius:6px}pre code{display:block;width:100vw;margin:48px calc(-1*var(--n));padding:18px var(--n);background-color:#fafafa;border:1px solid #f4f4f4;border-width:1px 0;border-radius:0;overflow-x:scroll}@media (prefers-color-scheme:dark){code{background-color:#111;border-color:#222}pre code{background-color:#080808;border-color:#111}}@media (max-width:767px){a,p>code{word-break:break-all}}</style><link href="/689ab9c9.css" rel="stylesheet"/></head><body><div class="a"><a href="/" class="b">Jacob<br/>does<br/>code</a><div class="c">Apps</div><a href="/pocket-jam" class="e">Pocket Jam</a><a href="/piano-tabs" class="e">Piano Tabs</a><a href="/technicalc" class="e">TechniCalc</a><a href="/freebies" class="e">Freebies</a><div class="c d">Developement</div><a href="/blog" class="e">Blog</a><a href="https://github.com/jacobp100" class="e">Github</a></div><div><h1>React Native on macOS</h1><p>One of my apps, <a href="/technicalc">TechniCalc</a>, is made with React Native. Recently, I got it running on macOS. Hereâ€™s what I learned.</p><p>First, some details on macOS. Up until a few years ago, Mac apps had to be written in AppKit, and iOS apps had to be written in UIKit. The latter is still true, but with the advent of Catalyst from Apple, it is possible to run UIKit on macOS.</p><p>This wasnâ€™t just just an effort of getting UIKit to physically run, but also an effort of getting UIKit to handle macOS nuances. For example, some gestures â€” like scrolling and swiping â€” happen by the trackpad, but some â€” like tapping and dragging â€” work by the pointer. UIKit has been extended to allow customising these kind of things.</p><p>But aside from the efforts of getting UIKit to run well on macOS, there has been zero work from Apple to get AppKit and UIKit to work together. You cannot have a project using both.</p><p>Then this point might seem irrelevant now, but I promise it is important later. UIKit apps run through Catalyst are scaled to about 77% of the size theyâ€™d be on an iPad. This is because interface elements are smaller on Mac, and this compensates for that fact. Big Sur lets you turn this scaling off, but you should only do so if your elements will be correctly sized on Mac.</p><p>Now some details on React Native. The standard React Native library targets the UIKit framework. Somewhat recently, Microsoft released <a href="https://microsoft.github.io/react-native-windows/"><code>react-native-desktop</code></a>, which has the ability to run on Mac. It does this by targeting AppKit instead of UIKit.</p><p>So now, you have two options. Which one should you pick?</p><p>Firstly, if you use any native packages for React Native â€” like react-native-svg â€” they target UIKit. This means they will not work with React Native Desktop.</p><p>Secondly, if you use React Native Desktop, youâ€™ll have to make sure your UI scales correctly on macOS so it doesnâ€™t look out of place.</p><p>For these reasons, I went with Catalyst. Itâ€™s really easy to get started â€” just open Xcode, and in your project settings, youâ€™ll see the section Deployment Settings with options <em>iPhone</em>, <em>iPad</em>, and <em>Mac</em>. You just need to check that last checkbox.</p><h2>That Easy, Huh?</h2><p>No.</p><p>Firstly, it now wonâ€™t build on iOS or Mac. Youâ€™ll need to edit your <code>Podfile</code> and remove Flipper.</p><pre><code class="-H -I"><span class="-h">- use_flipper!</span>
<span class="-h">- post_install do |installer|</span>
<span class="-h">-   flipper_post_install(installer)</span>
<span class="-h">- end</span></code></pre><p>Now itâ€™ll run on iOS, but not Mac. Still in your <code>Podfile</code>, add these lines to the bottom. Youâ€™ll need to get your App Store Connect ID â€” just log in, click your name, <em>Edit Profile</em>, and youâ€™ll see it listed under <em>Team ID</em>. Finally, run <code>pod install</code>.</p><pre><code class="-H -I"><span class="-m">+ # https://github.com/CocoaPods/CocoaPods/issues/8891#issuecomment-546636698</span>
<span class="-m">+ def fix_config(config)</span>
<span class="-m">+   if config.build_settings['DEVELOPMENT_TEAM'].nil?</span>
<span class="-m">+     config.build_settings['DEVELOPMENT_TEAM'] = '&#x3C;YOUR APP STORE CONNECT TEAM ID>'</span>
<span class="-m">+   end</span>
<span class="-m">+ end</span>
<span class="-m">+ post_install do |installer|</span>
<span class="-m">+   installer.generated_projects.each do |project|</span>
<span class="-m">+     project.build_configurations.each do |config|</span>
<span class="-m">+         fix_config(config)</span>
<span class="-m">+     end</span>
<span class="-m">+     project.targets.each do |target|</span>
<span class="-m">+       target.build_configurations.each do |config|</span>
<span class="-m">+         fix_config(config)</span>
<span class="-m">+       end</span>
<span class="-m">+     end</span>
<span class="-m">+   end</span>
<span class="-m">+ end</span></code></pre><p>This is a hack (Iâ€™ve attached a link to the issue comment detailing this) â€” but this is a workaround youâ€™ll have to use for now.</p><p>After all this, your app should build.</p><p>But it wonâ€™t pass an app review. The menu bar added by default has items added that lead to nowvere. I tell you this from experience.</p><p>Itâ€™s easiest to just remove the items that you donâ€™t need. You can do this in <code>AppDelegate.m</code> by adding this method.</p><pre><code class="-H -J">- (<span class="-c">void</span>)buildMenuWithBuilder:(<span class="-c">id</span>&#x3C;<span class="-p">UIMenuBuilder</span>>)builder
{
  [builder removeMenuForIdentifier:<span class="-p">UIMenuEdit</span>];
  [builder removeMenuForIdentifier:<span class="-p">UIMenuFormat</span>];
  [builder removeMenuForIdentifier:<span class="-p">UIMenuHelp</span>];
}</code></pre><h2>The Mac Window</h2><p>Now your app is running on Mac, try resizing the window. Chances are, it didnâ€™t work so well and the content lagged while resizing. Catalyst can already be a bit sluggish sluggish, and the async layout in React Native only makes matters worse.</p><p>You can disable the resizing if you wish. In your <code>AppDelegate.m</code>, you can add the following lines.</p><pre><code class="-H -K">- (<span class="-p">BOOL</span>)application:(<span class="-p">UIApplication</span> *)application
  didFinishLaunchingWithOptions:(<span class="-p">NSDictionary</span> *)launchOptions
{
  <span class="_">// ...</span>

  <span class="-p">CGSize</span> size = <span class="-p">CGSizeMake</span>(width, height);
  [<span class="-c">self</span>.window.windowScene.sizeRestrictions setMinimumSize:size];
  [<span class="-c">self</span>.window.windowScene.sizeRestrictions setMaximumSize:size];

  <span class="-c">return</span> <span class="-j">YES</span>;
}</code></pre><p>If you disable sizing, double check it fits on a regular MacBook Pro 13â€³ screen!</p><h3>Advanced Window Configuration</h3><p>For TechniCalc, I wanted to copy the behaviour of the system calculator: it has a compressed size and expanded size â€” and you click the green button in the title bar to switch between the two. Only having two sizes means we wonâ€™t get a load of resize events, so the performance should be fine.</p><p>I also wanted to add the translucent background most Mac apps have.</p><p>The window configuration from UIKit is very limited â€” you can set minimum and maximum sizes, change the title bar, but not much else.</p><p>However, remember when I told you you couldnâ€™t mix AppKit and UIKit? I lied. But itâ€™s not pretty. You can follow <a href="https://crunchybagel.com/disabling-the-mac-zoom-maximise-button-in-catalyst/">this guide</a> to do so.</p><p>Once youâ€™ve set up the bundle, you can get it running in your React Native application by making the following changes to <code>AppDelegate.m</code>.</p><pre><code class="-H -K"><span class="-D">#<span class="-L">if</span> TARGET_OS_MACCATALYST</span>
<span class="-D">#import <span class="-o">&#x3C;React/RCTConstants.h></span></span>

<span class="-q"><span class="-c">@interface</span> <span class="-r">InteropViewController</span> : <span class="-r">UIViewController</span></span>
<span class="-c">@end</span>

<span class="-q"><span class="-c">@implementation</span> <span class="-r">InteropViewController</span></span>

- (<span class="-c">void</span>)viewDidAppear:(<span class="-p">BOOL</span>)animated
{
  [<span class="-c">super</span> viewDidAppear:animated];

  <span class="-p">NSURL</span> *bundleUrl = [<span class="-p">NSBundle</span>.mainBundle.builtInPlugInsURL URLByAppendingPathComponent:<span class="-k">@"MacInterop.bundle"</span>];
  <span class="-p">NSBundle</span> *bundle = [<span class="-p">NSBundle</span> bundleWithURL:bundleUrl];
  [bundle load];
  Class macInterop = <span class="-p">NSClassFromString</span>(<span class="-k">@"MacApp"</span>);
  SEL selector = <span class="-p">NSSelectorFromString</span>(<span class="-k">@"configureApp"</span>);
  [macInterop performSelector:selector];

  <span class="_">// Force update react-native Dimensions</span>
  [<span class="-p">NSNotificationCenter</span>.defaultCenter postNotificationName:RCTUserInterfaceStyleDidChangeNotification object:<span class="-j">nil</span>];
}

<span class="-c">@end</span>
<span class="-D">#<span class="-L">else</span></span>
<span class="-D">#<span class="-L">define</span> InteropViewController UIViewController</span>
<span class="-D">#<span class="-L">endif</span></span>

<span class="-q"><span class="-c">@implementation</span> <span class="-r">AppDelegate</span></span>

- (<span class="-p">BOOL</span>)application:(<span class="-p">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="-p">NSDictionary</span> *)launchOptions
{
  <span class="_">// ...</span>

  <span class="-p">UIViewController</span> *rootViewController = [InteropViewController new];
  rootViewController.view = rootView;
  <span class="-c">self</span>.window.rootViewController = rootViewController;
  [<span class="-c">self</span>.window makeKeyAndVisible];

  <span class="-c">return</span> <span class="-j">YES</span>;
}</code></pre><p>Now you have your bundle running, you should be able to access all the low-level functions you need to customise the window. If you want to see what happens in TechniCalc, check out <a href="https://gist.github.com/jacobp100/e7ee89f3324b36cb8a4f7547b0fbcd90">this gist</a>.</p><h2>The Little Things</h2><p>There will be a lot of small things you have to do to get it working like a Mac app. Take this tweet for example (no disrespect intended to this developer).</p><blockquote class="-M"><p lang="en" dir="ltr">Got <a href="https://twitter.com/devhub_app?ref_src=twsrc%5Etfw">@devhub_app</a> running on macOS via Apple&#39;s Project Catalyst. Not Electron. Not WebView. Native! ðŸ¤¯<br><br>Even swipe gestures (react-native-gesture-handler) work as expected, without conflicting with the scrolling. Amazing. <a href="https://t.co/vnVcFBes0x">pic.twitter.com/vnVcFBes0x</a></p>&mdash; Bruno Lemos (@brunolemos) <a href="https://twitter.com/brunolemos/status/1185636022346043392?ref_src=twsrc%5Etfw">October 19, 2019</a></blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>Youâ€™ll see most things work as expected. But at the 0:26 mark, they drag a list item with their pointer to reveal a menu action. On Mac, this should be a two-finger scroll.</p><p>I have a similar list in my app, but I use <code>react-native-action-view</code> instead. I ended up having to <a href="https://github.com/jacobp100/react-native-action-view">fork the library</a> to get the correct behaviour. You may find you need to fork libraries too.</p><p>At the moment, running React Native through Catalyst is not a very common path for developers. However, if more people do this and more people contribute to libraries and React Native itself when things fall short, we can make this experience better for everyone.</p></div></body></html>